<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ezen.carCamping.model.myPageMapper">
	<resultMap type="MemberDTO" id="memberMap">
		<id column="mem_num" property="mem_num" />
		<result column="mem_id" property="mem_id" />
		<result column="mem_email" property="mem_email" />
		<result column="mem_password" property="mem_password" />
		<result column="mem_userName" property="mem_userName" />
		<result column="mem_nickName" property="mem_nickName" />
		<result column="mem_phone" property="mem_phone" />
		<result column="mem_birthday" property="mem_birthday" />
		<result column="mem_gender" property="mem_gender" />
		<result column="mem_point" property="mem_point" />
		<result column="mem_rentalCount" property="mem_rentalCount" />
		<result column="mem_sysdate" property="mem_sysdate" />
		<result column="mem_accept_email" property="mem_accept_email" />
		<result column="mem_accept_phone" property="mem_accept_phone" />
		<result column="mem_accept_privacy"
			property="mem_accept_privacy" />
		<result column="mem_denied" property="mem_denied" />
		<result column="mem_image" property="mem_image" />
		<result column="mem_summary" property="mem_summary" />
		<result column="mem_introduce" property="mem_introduce" />
		<result column="mem_reviewCount" property="mem_reviewCount" />
		<association property="regionDTO" javaType="RegionDTO"
			resultMap="regionMap">
		</association>
	</resultMap>

	<resultMap type="AgencyDTO" id="agencyMap">
		<id column="agency_num" property="agency_num" />
		<result column="agency_location" property="agency_location" />
		<result column="agency_name" property="agency_name" />
		<result column="agency_phone" property="agency_phone" />
		<association property="regionDTO" javaType="regionDTO"
			resultMap="regionMap"></association>
	</resultMap>

	<resultMap id="brandCategoryMap" type="BrandCategoryDTO">
		<id column="brand_num" property="brand_num" />
		<result column="brand_name" property="brand_name" />
	</resultMap>

	<resultMap id="productCategoryMap" type="ProductCategoryDTO">
		<id column="pc_num" property="pc_num" />
		<result column="pc_name" property="pc_name" />
	</resultMap>

	<resultMap id="productMap" type="ProductDTO">
		<id column="prod_num" property="prod_num" />
		<result column="prod_name" property="prod_name" />
		<result column="prod_popular" property="prod_popular" />
		<result column="prod_price" property="prod_price" />
		<result column="prod_viewImage1" property="prod_viewImage1" />
		<result column="prod_viewImage2" property="prod_viewImage2" />
		<result column="prod_viewImage3" property="prod_viewImage3" />
		<result column="prod_viewImage4" property="prod_viewImage4" />
		<result column="prod_viewImage5" property="prod_viewImage5" />
		<result column="prod_summary" property="prod_summary" />
		<result column="prod_viewContent" property="prod_viewContent" />
		<result column="prod_sysdate" property="prod_sysdate" />
		<result column="prod_update" property="prod_update" />
		<result column="prod_reviewScore" property="prod_reviewScore" />
		<result column="prod_reviewCount" property="prod_reviewCount" />
		<association property="brandCategoryDTO"
			javaType="BrandCategoryDTO" resultMap="brandCategoryMap">
		</association>
		<association property="productCategoryDTO"
			javaType="ProductCategoryDTO" resultMap="productCategoryMap">
		</association>
	</resultMap>
	<resultMap id="productCartMap" type="ProductCartDTO">
		<id column="cart_num" property="cart_num" />
		<result column="cart_prodCount" property="cart_prodCount" />
		<result column="cart_from" property="cart_from" />
		<result column="cart_to" property="cart_to" />
		<association property="memberDTO" javaType="MemberDTO"
			resultMap="memberMap" />
		<association property="productDTO" javaType="ProductDTO"
			resultMap="productMap" />
		<association property="agencyDTO" javaType="AgencyDTO"
			resultMap="agencyMap" />
	</resultMap>

	<select id="cartProduct" parameterType="int"
		resultMap="productCartMap"><!-- 용품을 장바구니에 추가만 하는 쿼리문 -->
		select a.*,b.*, c.* from ProductCart as a left join Product as b on
		a.prod_num = b.prod_num left join Agency as c on a.agency_num =
		c.agency_num where a.mem_num = #{mem_num}
	</select>

	<insert id="insertCart" parameterType="ProductCartDTO">
		insert into ProductCart
		values(null, #{mem_num}, #{prod_num}, #{agency_num},
		#{cart_prodCount}, #{cart_from}, #{cart_to})
	</insert>

	<update id="updateCart" parameterType="ProductCartDTO">
		update ProductCart set
		cart_prodCount = #{cart_prodCount} where cart_from = #{cart_from} and
		cart_to = #{cart_to}
	</update>

	<delete id="deleteCart" parameterType="int">
		delete from ProductCart
		where cart_num = #{cart_num}
	</delete>

	<insert id="insertCartLog" parameterType="RentalLogDTO">
		insert into RentalLog
		(rental_num, mem_num, prod_num,
		agency_num,rental_productCount,rental_from,rental_to,
		rental_return,
		rental_extend,
		rental_notReturn,rental_price,rental_usePoint,rental_extendPrice,
		rental_notReturnPrice)
		values(null, #{mem_num}, #{prod_num},
		#{agency_num},
		#{cart_prodCount}, #{cart_from},
		#{cart_to}
		,0,0,0,#{rental_price},0,0,0)
	</insert>

	<resultMap type="RegionDTO" id="regionMap">
		<id column="region_num" property="region_num" />
		<result column="region_name" property="region_name" />
	</resultMap>

	<resultMap id="questionMap" type="QuestionDTO">
		<id column="question_num" property="question_num" />
		<result column="question_title" property="question_title" />
		<result column="question_content" property="question_content" />
		<result column="question_sysdate" property="question_sysdate" />
		<result column="question_reply" property="question_reply" />
		<result column="question_replySysdate"
			property="question_replySysdate" />
		<association property="memberDTO" javaType="MemberDTO"
			resultMap="memberMap" />
	</resultMap>
	<select id="myPageGetQuestion" resultMap="questionMap">
		select a.*,b.mem_id
		from Question a join Member b on a.mem_num=b.mem_num
	</select>
	<select id="myPageGetQuestionSelectMember"
		resultMap="questionMap">
		select a.*,b.mem_id from Question a join Member b on
		a.mem_num = b.mem_num where a.mem_num= #{mem_num}
	</select>
	<insert id="insertQuestion" parameterType="questionDTO">
		insert into Question
		(mem_num, question_title, question_content, question_sysdate,
		question_reply, question_replySysdate)
		values (#{memberDTO.mem_num},
		#{question_title},#{question_content},now(),null,null)
	</insert>
	<select id="getQuestion" parameterType="int"
		resultType="questionDTO">
		select * from Question where question_num = #{question_num}
	</select>

	<delete id="payCart" parameterType="int">
		delete from ProductCart
		where
		mem_num = #{mem_num}
	</delete>

	<!-- <select id="sendRentLog" parameterType="int" > select </select> -->

</mapper>






